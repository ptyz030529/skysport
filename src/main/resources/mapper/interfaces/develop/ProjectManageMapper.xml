<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skysport.inerfaces.mapper.ProjectManageMapper">
    <sql id="searchInfoSql">
		a.id AS id,
		a.seq_no AS seqNo,
		a.project_id AS natrualkey,
		a.project_name AS name,
		a.year_code AS yearCode,
		a.customer_id AS customerId,
		a.area_id AS areaId,
		a.series_id AS seriesId,
		a.creater AS creater,
		a.version AS version,
		a.sample_delivery AS sampleDelivery,
		a.is_need_swatch AS isNeedSwatch,
		a.is_need_preoffer AS isNeedPreOffer,
		a.need_preoffer_date AS needPreOfferDate,
		a.sketch_received_date AS sketchReceivedDate,
		a.file_location AS fileLocation,
		b.category_a_id AS categoryAid,
		b.category_a_name AS categoryAname,
		b.category_b_id AS categoryBid,
		b.category_b_name AS categoryBname,
		b.collection_number AS collectionNumber,
		b.main_color_ids AS mainColorIds,
		b.sex_ids AS sexIds,
		a.del_flag AS delFlag,
		a.update_time AS updateTime,
		a.remark AS remark
	</sql>

    <select id="queryInfo" resultType="ProjectBomInfo">
        select
        <include refid="searchInfoSql"/>
        FROM t_project a ,t_project_bom_baseinfo b
        WHERE a.project_id =#{natrualkey} and a.project_id = b.project_id
        limit 1
    </select>

    <select id="listInfosCounts" resultType="Integer">
		SELECT COUNT(*) FROM
		t_project where del_flag=0
	</select>

    <select id="listFilteredInfosCounts" resultType="Integer">
        SELECT COUNT(*) FROM
        t_project where del_flag=0
        <if test="searchValue !=null and searchValue != ''">
            and (
            project_name like concat('%',#{searchValue},'%') or
            project_id like concat('%',#{searchValue},'%') or
            year_code like concat('%',#{searchValue},'%') or
            remark like concat('%',#{searchValue},'%')
            )
        </if>
    </select>


    <select id="searchInfos" resultType="ProjectBomInfo">
        SELECT
        <include refid="searchInfoSql"/>
        FROM t_project a
        WHERE a.del_flag=0
        <if test="searchValue!=null and searchValue != ''">
            and (
            project_name like concat('%',#{searchValue},'%') or
            project_id like concat('%',#{searchValue},'%') or
            year_code like concat('%',#{searchValue},'%') or
            remark like concat('%',#{searchValue},'%')
            )
        </if>
        <if test="orderColumn!=null and orderColumn != ''">
            ORDER BY ${orderColumn} ${orderDir}
        </if>
        limit #{start} ,#{length}

    </select>

    <update id="updateInfo">
		update
			t_project
		set
			project_name=#{name},
			year_code=#{customerId},
			area_id =#{areaId},
			series_id =#{seriesId},
			creater =#{creater},
			version =#{mainColor},
			sample_delivery =#{fabricsEndDate},
			is_need_swatch =#{accessoriesEndDate},
			is_need_preoffer =#{preOfferDate},
			need_preoffer_date =#{clothReceivedDate},
			sketch_received_date =#{offerAmount},
			file_location =#{fileLocation},
			remark=#{remark}
		WHERE
			project_id =#{natrualkey}
	</update>


    <update id="updateBomInfo">
		update
			t_project
		set
			project_name=#{name},
			category_a_id=#{categoryAid},
			category_a_name =#{categoryAname},
			category_b_id =#{categoryBid},
			category_b_name =#{categoryBname},
			collection_number =#{collectionNumber},
			main_color_ids =#{mainColorIds},
			sex_ids =#{sexIds},
			remark=#{remark}
		WHERE
			project_id =#{natrualkey}
	</update>

    <insert id="add">
		insert into
		t_project (seq_no,project_id,project_name,year_code,customer_id,area_id,series_id,creater,version,sample_delivery,is_need_swatch,is_need_preoffer,need_preoffer_date,sketch_received_date,file_location,remark)
		values (#{seqNo},#{natrualkey},#{name},#{yearCode},#{customerId},#{areaId},#{seriesId},#{creater},#{version},#{sampleDelivery},#{isNeedSwatch},#{isNeedPreOffer},#{needPreOfferDate},#{sketchReceivedDate},#{fileLocation},#{remark})

	</insert>

    <insert id="addBomInfo">
		insert into
		t_project_bom_baseinfo (project_id,project_name,category_a_id,category_a_name,category_b_id,category_b_name,collection_number,main_color_ids,sex_ids,remark)
		values (#{natrualkey},#{name},#{categoryAid},#{categoryAname},#{categoryBid},#{categoryBname},#{collectionNumber},#{mainColorIds},#{sexIds},#{remark})
	</insert>
    <update id="del">
		update t_project
		set  del_flag=1
		where project_id =#{natrualkey}
	</update>


    <select id="queryCurrentSeqNo" resultType="String">
		select case when  max(seq_no) is NULL then 0 else max(project_id) end from t_project t where year_code = #{yearCode} and customer_id=#{customerId} and area_id =#{areaId} and series_id =#{seriesId}
	</select>

    <!--信息下拉列表-->
    <select id="querySelectList" resultType="CommonBean">
		select
			project_id AS natrualkey,
			project_name AS name
		from t_project
		where del_flag=0 and project_name like concat('%',#{name},'%')
	</select>

</mapper>